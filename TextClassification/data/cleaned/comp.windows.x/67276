b'' b'' b'we developed a toolkit running on the x window system.' b"the toolkit copes with any languages based on x11r5's i18n" b"facility. as you know, there are kinds of i18n implementation from mit's" b'x11r5 release xsi and ximp. our original implementation of the toolkit' b'uses xsi.' b'' b"our toolkit manages each character's size based on our own font management system." b"in order to do that, the 'wchar_t' typed character strings must be decomposed" b'to character sets. this means that if one wchar_t type compound string with' b'ascii and kanji mixed, for example, is given, each element of the wchar_t' b'array must be checked its corresponding character set based on a bit layout' b"and application environment's locale. in this case if the locale is 'japanese'," b'each wchar_t character will be classified either to iso8859-1, jisx0208 or so.' b'' b'we need a function to do this. the function must check how many characters' b'from the top are the same character set and what the character set is.' b'' b'we could not find any public x11r5 function to do that and inevitably, used' b"xsi's internal functions to construct that function. the following is the" b"source code of that function 'decomposecharacterset()'." b'' b'' b'//i18n.h' b'// this may look like c code, but it is really c++ b'// $id: i18n.h,v iima exp iima b'' b'#ifndef _i18n_h' b'#define _i18n_h' b'' b'#include <x11/xlib.h' b'' b'extern int decomposecharacterset(const wchar_t *wc_str,\t/* in b'int wc_len,\t\t/* in b'char *buf,\t\t/* out b'int *buflen,\t\t/* in/out b'int *scanned_len,\t/* out b'char **charset);\t/* out b'extern xmstring wchartoxmstring(const wchar_t *wc_str);' b'extern xmstringcharset charsetofwchar(const wchar_t wc);' b'' b'#endif _i18n_h b'' b'//i18n.cc' b'/* $id: i18n.cc,v iima exp b'' b'#include <stdlib.h' b'#include <x11/xlibint.h' b'#include <xm/xm.h' b'#include "i18n.h"' b'' b'extern "c" b'#include <x11/wchar.h' b'#define _xwcdecomposeglyphcharset xxx_xwcdecomposeglyphcharset' b'#define _xmbfscs xxx_xmbfscs' b'#define _xmbctidtocsid xxx_xmbctidtocsid' b'#include "xlocaleint.h"' b'#undef _xwcdecomposeglyphcharset' b'#undef _xmbfscs' b'#undef _xmbctidtocsid' b'extern int _xwcdecomposeglyphcharset(xlocale, const wchar_t*, int,' b'char*, int*, int*, int*);' b'extern charset *_xmbfscs(xlocale, _csid);' b'extern _csid _xmbctidtocsid(xlocale, _csid);' b'};' b'' b'int decomposecharacterset(const wchar_t *wc_str,/* in b'int wc_len,\t\t/* in b'char *buf,\t\t/* out b'int *buf_len,\t\t/* in/out b'int *scanned_len,\t/* out b'char **charset)\t/* out b'{' b'xlocale xlocale _xfallbackconvert();' b'int ctid;' b'int status;' b'charset *xcharset;' b'' b'status _xwcdecomposeglyphcharset(xlocale, wc_str, wc_len, buf,' b'buf_len, scanned_len, &ctid);' b'if (status success) b'xcharset _xmbfscs(xlocale, _xmbctidtocsid(xlocale, ctid));' b'*charset (xcharset) xcharset-cs_name null;' b'}' b'else' b'*charset null;' b'return status;' b'}' b'----------------' b'' b'an included file above, "xlocaleint.h", is also xsi internal and we copied' b'the file to the toolkit directory and compiled.' b'' b'a serious issue occured when we tried to compile a toolkit application on' b'our hp machine with its os version of hp-ux9.01.' b'' b'when we tried to link an application based on our toolkit,' b'link errors occured saying that the following functions are missing:' b'_xmbctidtocsid (code)' b'_xmbfscs (code)' b'_xwcdecomposeglyphcharset (code)' b'_xfallbackconvert (code)' b'' b'we had used mit release version of x11r5 and its xsi implementation until' b'hp-up9.0 and ran applications successfully. one of the reasons to use xsi was that' b"because hp did not release hp's x11r5 until the os and we had no way to" b"know how hp's r5 would be implemented. we had hoped xsi's popularity and used" b'its internal functions.' b'' b"the hp's linker complains that there are no xsi internal functions implemented." b"we observe from hp's libx11.a, they used some ximp implementation but we are" b"not sure if they used mit's vanilla ximp version or their own version of ximp and" b"therefore, finding just counter part functions in mit's ximp for xsi does not" b'seem to lead us a solution.' b'' b'my question and goal is to know how we can construct a function like' b"'decomposecharacterset()' listed above. is there any function to check" b'character set of each element of wchar_t type strings depending on locales?' b'if it is a public function, that is perfect but even if it is not, we' b"want to use any internal functions in hp's x11r5 as we did for mit's r5." b'' b"in order to render a 'wchar_t' type string, there must be some machinery" b'to judge character sets and that is how the proper fonts are selected for' b"the string. we have no way to find out that without any hp's x11r5 source" b'files. we want to know how we can use that for our goal.' b'any help or comments would be highly appreciated.' b'' b'i also appreciate if anyone tell me about ximp treating around this area' b"even if it is not hp's implementation." b'' b'thank you.' b'' b'--' b'takeshi inoue' b'yokogawa electric corporation' b'open systems laboratory\t0422(52)5557' 